{$xxajax}
<!-- BEGIN PAGE CONTAINER-->
<div class="container-fluid">
    <!-- BEGIN PAGE HEADER-->   
    <div class="row-fluid">
        <div class="span12">                
            <h3 class="page-title">
                Modulo {$NomeModulo}                
            </h3>
            <ul class="breadcrumb">
                <li>
                    <i class="icon-home"></i>
                    <a href="index.html">Home</a> 
                    <span class="icon-angle-right"></span>
                </li>
                <li>
                    <a href="#">{$NomeModulo}</a>               
                </li>

            </ul>
        </div>
    </div>
    <!-- END PAGE HEADER-->

    <!-- BEGIN PAGE CONTENT-->   
    <div class="row-fluid">
        <div class="span12">
            <!-- BEGIN VALIDATION STATES-->
            <div class="portlet box green">
                <div class="portlet-title">
                    <h4><i class="icon-reorder"></i>Dados</h4>                    
                </div>
                <div class="portlet-body form">
                    <!-- BEGIN FORM-->                     
                    <form id="frm_{$modulo}" name="frm_{$modulo}" action="#" method="post" class="form-horizontal" >
                        <input type="hidden" name="f_action" id="f_action" value="{$acao}" />
                        <input type="hidden" name="f_mod" id="f_mod" value="{$modulo}" />                            
                        <input type="hidden" id="cod_noticia" name="cod_noticia" value="{$dados.cod_noticia}">
			<input type="hidden" id="cod_noticia_imagem" name="cod_noticia_imagem" value="{$dados.cod_noticia_imagem}">

                        <div class="alert alert-error hide">
                            <button class="close" data-dismiss="alert"></button>                            
                        </div>
                        <div class="alert alert-success hide">
                            <button class="close" data-dismiss="alert"></button>                            
                        </div>

                        <div class="control-group">                          
                            <label class="control-label">{$lng.txt_nom_titulo}<span class="required">*</span> </label>
                            <div class="controls">
                                <input type="text"  {$display_form}  id="nom_titulo" name="nom_titulo" value="{$dados.nom_titulo}" maxlength="60" data-required="1" class="span6 m-wrap popovers required" {if $TipAjuda[159]} data-content="{$TipAjuda[159]}" data-original-title="Dica" data-trigger="hover" data-placement="top" data-trigger="hover" data-placement="top" {/if}>
                                       <span {$display_info} class="text">{$dados.nom_titulo} </span>
                            </div>	
                        </div>
                        <div class="control-group">                          
                            <label class="control-label">{$lng.txt_dsc_noticia}<span class="required">*</span> </label>
                            <div class="controls">
                                <textarea class="span6 m-wrap required" {$display_form} rows="5" id="dsc_noticia" name="dsc_noticia" value="{$dados.dsc_noticia}" {if $TipAjuda[160]} data-content="{$TipAjuda[160]}" data-original-title="Dica" data-trigger="hover" data-placement="top" data-trigger="hover" data-placement="top" {/if}>{if $dados.dsc_noticia}{$dados.dsc_noticia}{/if}</textarea>                                
                                <span {$display_info} class="text">{$dados.dsc_noticia} </span>
                            </div>
                        </div>	
                       
                        <div class="control-group">
                            <label class="control-label">{$lng.txt_nom_caminho_img}</label>
                            <div class="controls">
                                <div class="fileupload fileupload-new" data-provides="fileupload">
                                    <div class="fileupload-new thumbnail" style="width: 350px; height: 150px;">
                                        <img src="http://www.placehold.it/350x150/EFEFEF/AAAAAA&amp;text=sem+imagem" alt="" />
                                    </div>
                                    <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 350px; max-height: 150px; line-height: 20px;"></div>
                                    <div>
                                        <span class="btn btn-file"><span class="fileupload-new">Selecione imagem - 379px X 208px</span>
                                            <span class="fileupload-exists">Mudar</span>
                                            {if $dados.dat_finalizado eq ''}<input type="file" id="Filedata" name="Filedata" class="default" />{/if}					    
                                            <input type="hidden" id="nom_caminho_img" name="nom_caminho_img" value="{$dados.nom_caminho_img}" />
                                        </span>
					<div id="response"></div>
                                        <!--<a href="#" class="btn fileupload-exists" data-dismiss="fileupload">Remover</a>-->
                                        
                                    </div>                                    
                                </div>  
                                <span class="text"><a href="{$dados.nom_caminho_img}" target="_blank">{$dados.nom_caminho_img}</a></span>
                            </div>
                        </div>
                        
                        <div class="control-group">                          
                            <label class="control-label">{$lng.txt_dat_inicio}<span class="required">*</span></label>
                            <div class="controls">
                                <div class="input-prepend date date-picker" data-date="{$smarty.now|date_format:'%d/%m/%Y'}" data-date-format="dd/mm/yyyy" data-date-viewmode="years" {$display_form}>
                                    <span class="add-on" ><i class="icon-calendar"></i></span><input class="m-wrap m-ctrl-medium required" size="16" type="text" id="dat_inicio" name="dat_inicio" value="{$dados.dat_inicio|date_format:'%d/%m/%Y'}" />
                                </div>                                
                                <span {$display_info} class="text">{$dados.dat_finalizado|date_format:"%d/%m/%Y"} </span>
                            </div>
                        </div>	
                        <div class="control-group">
				    <label class="control-label">{$lng.txt_dat_finalizado}</label>
				    <div class="controls">					
					<div class="input-prepend date date-picker" data-date="{$dados.dat_finalizado|date_format:'%d/%m/%Y'}" data-date-format="dd/mm/yyyy" data-date-viewmode="years" data-date-startdate="{$smarty.now|date_format:'%d/%m/%Y'}" {$display_form}>
					    <span class="add-on" ><i class="icon-calendar"></i></span><input class="m-wrap m-ctrl-medium" size="16" type="text" id="dat_finalizado" name="dat_finalizado" value="{$dados.dat_finalizado|date_format:'%d/%m/%Y'}" />
					</div>
    				    <span {$display_info} class="text">{$dados.dat_finalizado|date_format:"%d/%m/%Y %T"} </span>
					
				    </div>
				</div>	
                        <div class="control-group">
                            <label class="control-label">{$lng.txt_dat_cadastro}<span class="required">*</span> </label>
                            <div class="controls">
                                <span class="text">{if $dados.dat_cadastro eq ''}{$smarty.now|date_format:"%d/%m/%Y %T"}{else}{$dados.dat_cadastro|date_format:"%d/%m/%Y %T"}{/if}</span>
                            </div>
                        </div>
                        {if $Revenda eq 0}
				<div class="control-group">				    
				    <label class="control-label">{$lng.txt_cod_usuario}<span class="required">*</span> </label>
				    <div class="controls">
					<select {$display_form} id="cod_usuario" name="cod_usuario"  maxlength="11" data-required="1" class="span6 m-wrap popovers required" {if $TipAjuda[158]} data-content="{$TipAjuda[158]}" data-original-title="Dica" data-trigger="hover" data-placement="top" data-trigger="hover" data-placement="top" {/if}>
					    <option value=''>Selecione</option>
					    {html_options options=$lstcod_usuario selected=$dados.cod_usuario}
					</select>
					<span {$display_info} class="text">{$dados.nom_usuario} </span>					
				    </div>
				</div>
				{else}
				    <input type="hidden" id="cod_usuario" name="cod_usuario" value="{$smarty.session.usr.cod_usuario}">
				{/if}
                    </form> 
                </div>
            </div>
            <!-- END VALIDATION STATES-->            
        </div>       
    </div>
    <!-- END PAGE CONTENT-->         
</div>
{literal}
<script>
    var modulo = {/literal}'{$modulo}'{literal};

    (function () {
        var input = document.getElementById("Filedata"), 
        formdata = false;   

        if (window.FormData) {
            formdata = new FormData();            
        }
	
        input.addEventListener("change", function (evt) { 
	    $("#response").html("Carregando . . .");	    
            var i = 0, len = this.files.length, img, reader, file;
	
            for ( ; i < len; i++ ) {
                file = this.files[i];
	
                if (!!file.type.match(/image.*/)) {
                    if ( window.FileReader ) {
                        reader = new FileReader();					
                        reader.readAsDataURL(file);
                    }
                    if (formdata) {
                        formdata.append("images[]", file);
                    }
                }	
            }
	
            if (formdata) {
                $.ajax({
                    url: "appUploads.php?modulo="+modulo,
                    type: "POST",
                    data: formdata,
                    processData: false,
                    contentType: false,
                    success: function (response) {                                                
			if(response == 'Error'){
			    alert("Extensao nao permitida, favor enviar outro arquivo compativel com as extensoes: Pdf|Doc|Docx|Jpeg|Jpg|png|gif|xls|xlsx");
			}else{			
                         $("#nom_caminho_img").val(response);		  
			 $("#response").html("Imagem anexada, favor salvar abaixo!");
			}			 
                    }
                });
            }
        }, false);
    }());
  
    $("#dat_finalizado,#dat_inicio").live("blur", function(){ 
            
            var dias = 0;            
            alert('Validando datas...');
            
            var date2 = new String($("#dat_inicio").val());
            date2 = date2.split("/");        
            var eDate = new Date(date2[1]+"/"+date2[0]+"/"+date2[2]);
            
            var date1 = new String($("#dat_finalizado").val());
            date1 = date1.split("/");
            var sDate = new Date(date1[1]+"/"+date1[0]+"/"+date1[2]);

            dias = Math.round((sDate-eDate)/86400000);
            if(dias <= 0 ){
                alert('Favor preencher as datas corretas. O campo data finalizado deve ser maior que a data de inicio.');
                $("#dat_inicio").val('');
                $("#dat_finalizado").val('');
            }      
        
    });
</script>
{/literal}